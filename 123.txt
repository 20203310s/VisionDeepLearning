#include <Wire.h>
#include <LiquidCrystal_I2C.h>

LiquidCrystal_I2C lcd(0x27, 16, 2);

const int LM35Pin = 0;
const int CdsPin = 1;
const int buzzerPin = 9; // 버저 핀
const int ledPin = 13; // LED 핀

void setup() {
  lcd.init();
  lcd.backlight();

  lcd.print("ex 6.3");
  lcd.setCursor(0, 1);
  lcd.print("Checking Temp.");

  delay(3000);

  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("illuminance:");
  lcd.setCursor(0, 1);
  lcd.print("Temp. is ");

  lcd.setCursor(13, 1);
  lcd.write(B11011111);

  lcd.setCursor(14, 1);
  lcd.print("C");

  pinMode(buzzerPin, OUTPUT);
  pinMode(ledPin, OUTPUT);
}

void loop() {
  int adcValue;
  int illuminance;
  long temp;

  adcValue = analogRead(LM35Pin);
  temp = (adcValue * 500L) / 1023;

  adcValue = analogRead(CdsPin);
  illuminance = map(adcValue, 0, 1023, 100, 0);

  lcd.setCursor(12, 0);
  lcd.print("      ");

  lcd.setCursor(12, 0);
  lcd.print(illuminance);

  lcd.setCursor(10, 1);
  lcd.print("   ");

  lcd.setCursor(10, 1);
  lcd.print(temp);

  if (illuminance < 30) { // 조도 값이 30 미만이면 LED를 켬
    digitalWrite(ledPin, HIGH);
    tone(buzzerPin, 1000); // 버저 소리를 출력
  } else {
    digitalWrite(ledPin, LOW);
    noTone(buzzerPin); // 조도 값이 30 이상이면 LED를 끔, 버저 소리 중지
  }

  if (temp < 25) { // 온도 값이 25 미만이면 LED를 켬
    digitalWrite(ledPin, HIGH);
    tone(buzzerPin, 1000); // 버저 소리를 출력
  } else {
    digitalWrite(ledPin, LOW);
    noTone(buzzerPin); // 온도 값이 25 이상이면 LED를 끔, 버저 소리 중지
  }

  delay(2000);
}